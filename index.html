<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Editor de Grafos</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cytoscape/3.24.0/cytoscape.min.js"></script>
    <style>
        #cy {
            width: 80%;
            height: 500px;
            border: 1px solid black;
            margin: auto;
        }
        .controls {
            display: flex;
            justify-content: center;
            margin-top: 10px;
            gap: 10px;
        }
    </style>
</head>
<body>
    <div id="cy"></div>
    <div class="controls">
        <button onclick="addNode()">Agregar Nodo</button>
        <button onclick="deleteNode()">Eliminar Nodo</button>
        <input type="text" id="nodeLabel" placeholder="Nombre del nodo" oninput="updateNodeLabel()">
        <input type="number" id="duration" placeholder="Duración" oninput="updateEdgeData()">
        <input type="number" id="cost" placeholder="Costo" oninput="updateEdgeData()">
    </div>
    
    <script>
        let cy = cytoscape({
            container: document.getElementById('cy'),
            elements: [],
            style: [
                {
                    selector: 'node',
                    style: {
                        'label': 'data(label)',
                        'background-color': '#4caf50',
                        'color': 'white',
                        'text-valign': 'center',
                        'text-halign': 'center',
                        'width': '45px',
                        'height': '45px',
                        'font-size': '14px'
                    }
                },
                {
                    selector: 'edge',
                    style: {
                        'width': 2,
                        'line-color': '#ccc',
                        'target-arrow-shape': 'triangle',
                        'curve-style': 'bezier',
                        'target-arrow-color': '#ccc',
                        'label': 'data(label)'
                    }
                }
            ]
        });

        let nodeId = 0;
        let selectedNode = null;
        let selectedEdge = null;
        let edgeStartNode = null;

        function addNode() {
            nodeId++;
            cy.add({
                data: { id: '' + nodeId, label: 'Nodo ' + nodeId },
                position: { x: Math.random() * 500, y: Math.random() * 500 }
            });
        }

        function deleteNode() {
            if (selectedNode) {
                cy.remove(selectedNode);
                selectedNode = null;
                edgeStartNode = null;
                document.getElementById('nodeLabel').value = '';
            }
        }

        function updateNodeLabel() {
            if (selectedNode) {
                let newLabel = document.getElementById('nodeLabel').value;
                selectedNode.data('label', newLabel);
            }
        }

        function updateEdgeData() {
            if (selectedEdge) {
                let newDuration = document.getElementById('duration').value || '0';
                let newCost = document.getElementById('cost').value || '0';

                selectedEdge.data({
                    duration: newDuration,
                    cost: newCost,
                    label: `Dur: ${newDuration}, Costo: ${newCost}`
                });
            }
        }

        cy.on('tap', 'node', function(evt) {
            let tappedNode = evt.target;

            if (!edgeStartNode) {
                edgeStartNode = tappedNode;
            } else if (edgeStartNode !== tappedNode) {
                let duration = document.getElementById('duration').value || '0';
                let cost = document.getElementById('cost').value || '0';

                cy.add({
                    data: {
                        id: `edge-${edgeStartNode.id()}-${tappedNode.id()}`,
                        source: edgeStartNode.id(),
                        target: tappedNode.id(),
                        label: `Dur: ${duration}, Costo: ${cost}`,
                        duration: duration,
                        cost: cost
                    }
                });

                edgeStartNode = null; // Reset para el próximo enlace
            }
            selectedNode = tappedNode;
            document.getElementById('nodeLabel').value = tappedNode.data('label');
        });

        cy.on('tap', 'edge', function(evt) {
            selectedEdge = evt.target;
            document.getElementById('duration').value = selectedEdge.data('duration');
            document.getElementById('cost').value = selectedEdge.data('cost');
        });

    </script>
</body>
</html>
